<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Testing IMO Portal Web Service</title>
    <script type="text/javascript" src="/scripts/jquery-1.11.1.js"></script>
    <link href="/css/reset.css" rel="stylesheet" type="text/css" />
    <link href="/css/standard.css" type="text/css" rel="stylesheet" />
    <link href="/css/blackriverinc.css" rel="stylesheet" />

    <script type="text/javascript">
        function formatJSONString(jsonString) {
            return jsonString
                    .replace(/\}/g, '}<br/>')
                    .replace(/,/g, ',<br/>')
                    .replace(/\{/g, '<br/>{<br/>')
                    .replace(/<br\/>/, '')
            ;

        }

        function formatJSON(objet, depth) {

            if (depth == null) {
                depth = 0;
            }
            if (depth > 6) {
                return "   *Runaway recursion*   ";
            }

            var jStrings = new Array(3);
            jStrings[1] = '';
            if (typeof (objet) == 'object') {

                jStrings[0] = ((depth > 0)?('<br/>' + '&nbsp;'.repeat(depth * 2)):'') 
                                + '{<br/>';
                for (var prop in objet) {
                    if (!objet.hasOwnProperty(prop)) {
                        continue;
                    }
                    if (jStrings[1].length > 0) {
                        jStrings[1] += ',</br>';
                    } else {
                        jStrings[1] = '';
                    }
                    jStrings[1] += '&nbsp;'.repeat(depth * 2) + '"' + prop + '" : '
                                      + formatJSON(objet[prop], depth + 1);
                }
                jStrings[2] = '<br/>' + '&nbsp;'.repeat(depth * 2) + '}';

            } else {
                jStrings[0] = '"';
                jStrings[1] = objet;
                jStrings[2] = '"';
            }
            return jStrings.join('');
        }

            $(document).ready(function () {

                $('#response').hide();

                console.log('Ready!');

                var portal = 'https://portalwebservice.e-imo.com:443/api/product';

                $('#path').val(portal);

                $('#request').click(function (src) {

                    $('#response').hide();

                    var path = $('#path').val() + '?xv=' + (new Date()).getMilliseconds().toString();

                    $.ajax(path, {
                        crossDomain: true,
                        method: 'GET'
                    })
                        .done(function (data, status, response) {
                            if (response.responseJSON == null) {
                                $('#response').html(data)
                            } else {
                                $('#response').html(formatJSON(response.responseJSON))
                            }
                            $('#response').show();
                        })
                        .fail(function () {
                            $('#response').html('<h4>Query failed!</h4>')
                            $('#response').show();
                        });

                });
            });
    </script>
</head>
<body style="margin-left: auto; margin-right: auto; width: 75%;" class="box-border-all">
    <h2>AJAX CORS Test</h2>
    <!--
    <form id="portal" action="https://portalwebservice.e-imo.com:443/api/product?xv=" method="get">
    -->
    <div style="width: 75%; margin-right: auto; margin-left: auto;">
        <input type="text" id="path" style="width: 80%; border: 2px inset darkgray; padding: 4px; background-color: white;" />

        <button id="request" class="button" style="float: right;">Query</button>
    </div>
    <div id="response"
        class="blockquote"
        style="margin-top: 8px; width: 75%; margin-right: auto; margin-left: auto; border: 2px inset darkgray; padding: 4px; background-color: whitesmoke;">
    </div>
    <!--
    </form>
    -->
</body>
</html>
